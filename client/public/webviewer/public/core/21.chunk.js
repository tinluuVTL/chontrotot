/** Notice * This file contains works from many authors under various (but compatible) licenses. Please see core.txt for more information. **/
(function(){(window.wpCoreControlsBundle=window.wpCoreControlsBundle||[]).push([[21],{567:function(wa,ta,h){h.r(ta);var pa=h(0),na=h(7),oa=h(3);wa=h(55);var ka=h(33),la=h(14);h=function(){function ha(){this.init()}ha.prototype.init=function(){this.lia=!1;this.fg=this.Rn=this.connection=null;this.lv={};this.ga=this.NK=null};ha.prototype.xDa=function(z){for(var y=this,r=0;r<z.length;++r){var n=z[r];switch(n.at){case "create":this.lv[n.author]||(this.lv[n.author]=n.aName);this.Rra(n);break;case "modify":this.ga.Uq(n.xfdf).then(function(b){y.ga.sb(b[0])});
break;case "delete":this.ga.Uq("<delete><id>"+n.aId+"</id></delete>")}}};ha.prototype.Rra=function(z){var y=this;this.ga.Uq(z.xfdf).then(function(r){r=r[0];r.authorId=z.author;y.ga.sb(r);y.ga.trigger(na.c.UPDATE_ANNOTATION_PERMISSION,[r])})};ha.prototype.nra=function(z,y,r){this.Rn&&this.Rn(z,y,r)};ha.prototype.preloadAnnotations=function(z){this.addEventListener("webViewerServerAnnotationsEnabled",this.nra.bind(this,z,"add",{imported:!1}),{once:!0})};ha.prototype.initiateCollaboration=function(z,
y,r){var n=this;if(z){n.fg=y;n.ga=r.ma();r.addEventListener(na.h.DOCUMENT_UNLOADED,function(){n.disableCollaboration()});n.cEa(z);var b=new XMLHttpRequest;b.addEventListener("load",function(){if(200===b.status&&0<b.responseText.length)try{var a=JSON.parse(b.responseText);n.connection=exports.da.SEa(Object(ka.k)(n.fg,"blackbox/"),"annot");n.NK=a.id;n.lv[a.id]=a.user_name;n.ga.wT(a.id);n.connection.fIa(function(e){e.t&&e.t.startsWith("a_")&&e.data&&n.xDa(e.data)},function(){n.connection.send({t:"a_retrieve",
dId:z});n.trigger(ha.Events.WEBVIEWER_SERVER_ANNOTATIONS_ENABLED,[n.lv[a.id],n.NK])},function(){n.disableCollaboration()})}catch(e){Object(oa.g)(e.message)}});b.open("GET",Object(ka.k)(this.fg,"demo/SessionInfo.jsp"));b.withCredentials=!0;b.send();n.lia=!0;n.ga.z8(function(a){return n.lv[a.Author]||a.Author})}else Object(oa.g)("Document ID required for collaboration")};ha.prototype.disableCollaboration=function(){this.Rn&&(this.ga.removeEventListener(la.a.Events.ANNOTATION_CHANGED,this.Rn),this.Rn=
null);this.connection&&this.connection.Ks();this.ga&&this.ga.wT("Guest");this.init();this.trigger(ha.Events.WEBVIEWER_SERVER_ANNOTATIONS_DISABLED)};ha.prototype.cEa=function(z){var y=this;this.Rn&&this.ga.removeEventListener(la.a.Events.ANNOTATION_CHANGED,this.Rn);this.Rn=function(r,n,b){return Object(pa.b)(this,void 0,void 0,function(){var a,e,f,w,ca,ea,fa,x,ba;return Object(pa.d)(this,function(aa){switch(aa.label){case 0:if(b.imported)return[2];a={t:"a_"+n,dId:z,annots:[]};return[4,y.ga.z0()];case 1:e=
aa.ba();"delete"!==n&&(f=(new DOMParser).parseFromString(e,"text/xml"),w=new XMLSerializer);for(ca=0;ca<r.length;ca++)ea=r[ca],x=fa=void 0,"add"===n?(fa=f.querySelector('[name="'+ea.Id+'"]'),x=w.serializeToString(fa),ba=null,ea.InReplyTo&&(ba=y.ga.vf(ea.InReplyTo).authorId||"default"),a.annots.push({at:"create",aId:ea.Id,author:y.NK,aName:y.lv[y.NK],parent:ba,xfdf:"<add>"+x+"</add>"})):"modify"===n?(fa=f.querySelector('[name="'+ea.Id+'"]'),x=w.serializeToString(fa),a.annots.push({at:"modify",aId:ea.Id,
xfdf:"<modify>"+x+"</modify>"})):"delete"===n&&a.annots.push({at:"delete",aId:ea.Id});0<a.annots.length&&y.connection.send(a);return[2]}})})}.bind(y);this.ga.addEventListener(la.a.Events.ANNOTATION_CHANGED,this.Rn)};ha.Events={WEBVIEWER_SERVER_ANNOTATIONS_ENABLED:"webViewerServerAnnotationsEnabled",WEBVIEWER_SERVER_ANNOTATIONS_DISABLED:"webViewerServerAnnotationsDisabled"};return ha}();Object(wa.a)(h);ta["default"]=h}}]);}).call(this || window)
